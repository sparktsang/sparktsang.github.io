<!DOCTYPE html>
<html>
<head>
    {% include head.html %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    <style>
        /* ================== 穩固嘅 CSS 架構 ================== */

        /* 1. 全頁畫布背景 (今次保證佢喺最底層) */
        body::before {
            content: '';
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url('{{ site.baseurl }}/{{ page.image }}');
            background-size: cover; background-position: center; background-attachment: fixed;
            filter: brightness(0.6); /* <<< 濾鏡返嚟喇 */
            z-index: -1;
        }

        /* 2. Banner 內容區：只係一個佔空間嘅容器 */
        #gallery-banner-content {
            display: flex; align-items: center; justify-content: center; text-align: center;
            min-height: 50vh; /* 俾 Banner 內容足夠嘅空間 */
            color: white;
            padding: 2em;
        }

        /* 3. 主要內容區 (碎片容器)，設定為相對定位，俾碎片絕對定位用 */
        #main.gallery-container {
            position: relative; 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 2em;
        }

        /* 4. 單一碎片：絕對定位，位置由 JS 控制 */
        .post-piece {
            position: absolute; 
            width: 350px; 
            visibility: hidden; /* 等 JS 計算完位置再顯示 */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* 5. 圖片本身 */
        .post-piece .image-frag {
            width: 100%; height: 350px;
            background-size: cover; background-position: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.1);
        }

        /* 6. 文字區 (預設透明) */
        .post-piece .text-block {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(20, 25, 30, 0.85);
            display: flex; flex-direction: column; justify-content: center;
            text-align: center; padding: 1.5em;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        /* 7. Hover 效果：指向成個碎片時，文字區浮現 */
        .post-piece:hover .text-block {
            opacity: 1;
        }

        /* 8. 字體樣式 */
        .post-piece .text-block h2 {
            font-family: 'Zhi Mang Xing', cursive;
            font-size: 2.2em !important; color: #ffffff !important; font-weight: normal;
        }
        .post-piece .text-block p { color: rgba(255,255,255,0.7) !important; }
    </style>
</head>

<body>
    {% include header.html %}
    
    <!-- Banner 內容正式回歸 -->
    <div id="gallery-banner-content">
        <div class="inner">
            <h1>{{ page.title }}</h1>
            <p>{{ page.description }}</p>
        </div>
    </div>

    <!-- 主要內容區，準備俾 JS 擺嘢 -->
    <div id="main" class="gallery-container">
        {% assign life_posts = site.posts | where: "category", "Life" | reverse %}
        {% for post in life_posts %}
            <a href="{{ post.url | relative_url }}" class="post-piece" aria-label="{{ post.title }}">
                <div class="image-frag" style="background-image: url('{{ site.baseurl }}/{{ post.image }}');"></div>
                <div class="text-block">
                    <h2>{{ post.title }}</h2>
                    <p>{{ post.subtitle }}</p>
                </div>
            </a>
        {% endfor %}
    </div>

    {% include footer.html %}

    <!-- ================== 修正並強化後嘅 JS 算法 ================== -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 確保所有嘢都係喺 body 背景之上
            document.body.style.background = 'transparent';
            
            const container = document.querySelector('.gallery-container');
            const pieces = document.querySelectorAll('.post-piece');
            if (pieces.length === 0) return;

            // 網格參數
            const pieceWidth = 350;
            const pieceHeight = 350;
            const gap = 80; 
            const containerWidth = container.offsetWidth;
            const cols = Math.floor(containerWidth / (pieceWidth + gap));
            
            let grid = Array(cols).fill(0);

            pieces.forEach(piece => {
                let minColHeight = Math.min(...grid);
                let targetColIndex = grid.indexOf(minColHeight);

                let x = targetColIndex * (pieceWidth + gap);
                let y = minColHeight;

                piece.style.top = y + 'px';
                piece.style.left = x + 'px';
                piece.style.visibility = 'visible';
                piece.style.opacity = 1;

                grid[targetColIndex] += pieceHeight + gap;
            });

            container.style.height = Math.max(...grid) + 'px';
        });
    </script>
</body>
</html>
