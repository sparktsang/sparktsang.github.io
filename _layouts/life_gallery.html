<!DOCTYPE html>
<html>
<head>
    {% include head.html %}
    <!-- 1. 引入一個有「手寫感」嘅 Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    <style>
        /* ================== CSS 基礎設定 ================== */

        /* 2. 將 Banner 作為成個頁面嘅「畫布」 */
        body.gallery-body::before {
            content: '';
            position: fixed; /* 固定喺度，唔會跟住碌 */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('{{ site.baseurl }}/{{ page.image }}');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            filter: brightness(0.7); /* 稍微壓暗，突出碎片 */
            z-index: -1;
        }

        /* 3. 主要內容區，變成一個透明嘅容器，俾 JS 喺上面擺嘢 */
        #main.gallery-container {
            position: relative; /* 俾 JS 絕對定位用嘅參考點 */
            max-width: 1400px;
            margin: 0 auto;
            padding: 5em 2em;
            min-height: 100vh;
        }

        /* 4. 「碎片」嘅容器 (包含圖同文) */
        .post-piece {
            position: absolute; /* <<< 核心：位置將會由 JS 控制 */
            visibility: hidden; /* 預設隱藏，等 JS 計算完位置再顯示 */
        }
        
        /* 5. 圖片碎片本身嘅樣式 */
        .post-piece .image-frag {
            width: 300px; /* 相當於你講嘅 a */
            height: 300px; /* 正方形 */
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
        }
        .post-piece:hover .image-frag {
            transform: scale(1.05); /* 滑鼠移過去輕微放大 */
        }
        
        /* 6. 文字塊嘅樣式 */
        .post-piece .text-block {
            position: absolute;
            bottom: 20px; /* 位置可以微調 */
            left: 320px; /* 放喺圖片右邊 */
            width: 350px; /* 俾文字足夠嘅空間 */
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .post-piece .text-block h2 {
            font-family: 'Zhi Mang Xing', cursive; /* <<< 核心：使用手寫感字體 */
            font-size: 2.5em !important;
            color: #ffffff !important;
            font-weight: normal;
        }
    </style>
</head>

<body class="gallery-body">

    {% include header.html %}

    <!-- 主要內容區，只係一個空嘅容器 -->
    <div id="main" class="gallery-container">
        
        {% assign life_posts = site.posts | where: "category", "Life" | reverse %}
        {% for post in life_posts %}
            <!-- 7. Jekyll 只負責準備好一舊舊「材料」 -->
            <div class="post-piece">
                <a href="{{ post.url | relative_url }}">
                    <div class="image-frag" style="background-image: url('{{ site.baseurl }}/{{ post.image }}');"></div>
                </a>
                <div class="text-block">
                    <h2>{{ post.title }}</h2>
                    <p>{{ post.subtitle }}</p>
                </div>
            </div>
        {% endfor %}

    </div>

    {% include footer.html %}

    <!-- ================== JavaScript 隨機佈局算法 ================== -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('main');
            const pieces = document.querySelectorAll('.post-piece');
            if (pieces.length === 0) return;

            // 算法參數
            const a = 300; // 碎片嘅邊長 (px)
            const w = container.offsetWidth; // 容器嘅闊度
            const horizontalMargin = 50; // 左右邊距
            const verticalGap = a; // 垂直樓層高度

            let lastY = 0; // 追蹤上一塊碎片嘅 y 座標

            pieces.forEach((piece, index) => {
                // 水平位置：喺容器闊度內隨機擺放
                const maxLeft = w - a - horizontalMargin;
                let randomX = Math.random() * maxLeft;
                
                // 垂直位置：實現你嘅隨機「樓層」概念
                // 喺上一塊碎片嘅基礎上，向下移動 0 到 2 層樓嘅隨機距離
                let randomYOffset = Math.random() * (verticalGap * 2); 
                let currentY = lastY + randomYOffset;

                // 如果係第一塊，就俾個初始位置
                if(index === 0) {
                    currentY = 50; // 同頂部嘅距離
                }

                // 將計算好嘅位置應用到碎片上
                piece.style.top = currentY + 'px';
                piece.style.left = randomX + 'px';
                
                // 顯示返塊碎片
                piece.style.visibility = 'visible';

                // 更新 lastY，為下一塊碎片做準備
                lastY = currentY + a * 0.3; // 加一個細數值避免完全重疊
            });

            // 確保容器高度足夠裝晒所有碎片
            const lastPiece = pieces[pieces.length - 1];
            container.style.height = lastPiece.offsetTop + a + 200 + 'px';
        });
    </script>
</body>
</html>
