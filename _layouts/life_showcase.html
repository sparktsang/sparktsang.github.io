<!DOCTYPE html>
<html>
<head>
    {% include head.html %}
    <style>
        /* ===== 背景設定 (保持不變) ===== */
        body {
            background: url('{{ site.baseurl }}/{{ page.image }}') center center / cover no-repeat fixed;
            position: relative;
        }
        body::before {
            content: "";
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(20,20,20,0.85);
            z-index: -1; /* 將遮罩放喺最底層 */
        }
        #main.gallery-main, #banner { background: none !important; }
        #banner { padding: 8em 2em; }

        /* ===== Life showcase 佈局 (保持不變) ===== */
        #main.gallery-main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 4em 2em;
        }
        #main.gallery-main > section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            grid-gap: 6em;
            justify-items: center;
        }

        /* ===== 碎片方塊 (保持不變) ===== */
        .post-fragment {
            position: relative; /* <<< 核心：作為 popup 嘅定位參考點 */
            width: 220px;
            height: 220px;
            background-size: cover;
            background-position: center center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.35);
            transition: transform 0.3s ease-out;
            border-radius: 6px;
        }
        .post-fragment:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .post-fragment .click-area {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 3;
        }

        /* ===== 精靈 Popup (全新智能定位版本) ===== */
        .info-popup {
            position: absolute; /* <<< 核心改動：相對於 post-fragment 定位 */
            top: 50%;
            transform: translateY(-50%); /* 垂直置中對齊 */
            opacity: 0;
            z-index: -1; /* 預設喺圖片後面，避免影響 hover */
            pointer-events: none;
            
            /* 文字風格 */
            font-family: "Courier New", monospace;
            font-size: 0.9em;
            font-weight: bold;
            color: #5eead4;
            text-shadow: 0 0 5px rgba(94,234,212,0.8),
                         0 0 15px rgba(94,234,212,0.6);
            
            transition: opacity 0.3s ease-out;
        }
        
        /* ===== 核心改動：智能定位 ===== */
        /* 當碎片係單數 (喺左邊)，popup 就喺右邊出現 */
        .post-fragment:nth-child(odd) .info-popup {
            left: 115%; /* 喺碎片右邊 15% 嘅距離 */
            text-align: left;
        }
        /* 當碎片係雙數 (喺右邊)，popup 就喺左邊出現 */
        .post-fragment:nth-child(even) .info-popup {
            right: 115%; /* 喺碎片左邊 15% 嘅距離 */
            text-align: right;
        }

        .post-fragment:hover .info-popup {
            opacity: 1;
            z-index: 20; /* 顯示時提到最上層 */
        }
        
        /* ===== Popup 內部結構 (同之前一樣) ===== */
        .info-popup div { white-space: nowrap; overflow: hidden; border-right: 2px solid #5eead4; animation: caret 0.7s infinite; }
        .info-popup div:not(:last-child) { margin-bottom: 0.8em; }
        .info-popup div:nth-child(1) { font-size: 0.8em; opacity: 0.7; }
        .info-popup div:nth-child(2) { font-size: 1.2em; font-weight: bold; }
        .info-popup div:nth-child(3) { font-size: 0.9em; font-style: italic; white-space: normal; border-right: none; animation: none; }
        @keyframes caret { 50% { border-color: transparent; } }

    </style>
</head>

<body>
    {% include header.html %}
    <section id="banner">
        <div class="inner">
            <header class="major"><h1>{{ page.title }}</h1></header>
            <div class="content"><p>{{ page.description }}</p></div>
        </div>
    </section>

    <div id="main" class="gallery-main">
        <section>
            {% assign life_posts = site.posts | where: "category", "Life" | reverse %}
            {% for post in life_posts %}
                <article class="post-fragment" style="background-image: url('{{ site.baseurl }}/{{ post.image }}');">
                    <a href="{{ post.url | relative_url }}" class="click-area" aria-label="{{ post.title }}"></a>
                    <div class="info-popup" data-title="{{ post.title }}" data-subtitle="{{ post.subtitle }}" data-date="{{ post.date | date: '%Y-%m-%d' }}"></div>
                </article>
            {% endfor %}
        </section>
    </div>

    {% include footer.html %}

    <!-- ===== JS (極簡化版本) ===== -->
    <script>
        // 打字動畫函數 (保持不變)
        function typeText(element, text, speed = 25, callback) {
            element.textContent = ""; let i = 0;
            function typing() {
                if (i < text.length) {
                    element.textContent += text.charAt(i); i++;
                    setTimeout(typing, speed);
                } else { if (callback) callback(element); }
            }
            typing();
        }

        document.querySelectorAll('.post-fragment').forEach(fragment => {
            const popup = fragment.querySelector('.info-popup');
            const title = popup.dataset.title;
            const subtitle = popup.dataset.subtitle;
            const date = popup.dataset.date;
            let typingTimeout;

            // JS 依家只負責動畫，唔再負責定位
            fragment.addEventListener('mouseenter', () => {
                popup.innerHTML = "";
                const d = document.createElement("div");
                const t = document.createElement("div");
                const s = document.createElement("div");
                popup.appendChild(d); popup.appendChild(t); popup.appendChild(s);

                clearTimeout(typingTimeout);
                typeText(d, date, 20);
                typingTimeout = setTimeout(() => {
                    typeText(t, title, 15);
                    typingTimeout = setTimeout(() => {
                        typeText(s, subtitle, 20, (el) => {
                            el.style.borderRight = 'none'; el.style.animation = 'none';
                        });
                    }, title.length * 20);
                }, date.length * 25);
            });
        });
    </script>
</body>
</html>
